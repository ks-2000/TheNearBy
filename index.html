<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>TheNearBy</title>

    <!-- linking styles and materialize css -->
    <link type = "text/css" href="/styles.css" rel="stylesheet">
    <link type = "text/css" href="/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <link rel = "manifest" href="/manifest.json">

    <!--iOS support -->
    <link rel="apple-touch-icon" href="icons/apple-icon-180.png">

    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="icons/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <meta name="theme-color" content="#B83B5E">

</head>
<body>

  <!-- Navigation bar-->
    <nav style="background-color: #B83B5E;" class="z-depth-0">
      <div class="nav-wrapper container">
        <a href="/index.html"><span>Dashboard</span></a>
        <span class="center white-text text-darken-1">
          <i class="material-icons sidenav-trigger" data-target="side-menu">menu</i>
        </span>
      </div>
    </nav>
   
    <!--Side menu-->
    <ul id="side-menu" class="sidenav side-menu">
      <li><a class="subheader">TheNearBy</a></li>
      <li><a href="/index.html" class="waves-effect">Home</a></li>
      <li><a href="/pages/about.html" class="waves-effect">About</a></li>      
    </ul>

<!---------------- Search bar ------------------------------->
    <div class="search-bar">
      <input id="search-bar" type="text" placeholder="Search location">
      <div class="search icon" onclick="search()">
        <i id="search-icon" class="material-icons">search</i>
      </div>
    </div>

<!---------------- Restaurants -------------------------------->
     <div class="restaurants container grey-text text-darken-1" id="card-panel-container"></div>
    

      <script type="module">

/*----------------------Imports, Export and Configurations------------------------------------*/
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
       
          const firebaseConfig = {
            apiKey: "AIzaSyBqJ3jAAvudWn37JSOlRnQMLdiu-SzQ5fM",
            authDomain: "thenearby-pwa.firebaseapp.com",
            projectId: "thenearby-pwa",
            storageBucket: "thenearby-pwa.appspot.com",
            messagingSenderId: "966537773037",
            appId: "1:966537773037:web:858aa3abfda9bfd08ef1e4",
            measurementId: "G-ZZF165XZCE"
          };

          const app = initializeApp(firebaseConfig);

          import{
            getFirestore,doc, getDoc, getDocs, onSnapshot, collection, query, where
          }
          from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";

          const db = getFirestore();

//------------------------- Fill Card Panel ------------------------------------//
        var rid ;
        var ids = [];
        var cardPanelContainer = document.getElementById('card-panel-container');

        function AddItemToCardPanel(id, name, location, image) {
          let cardPanel = document.createElement("div");
          cardPanel.classList.add("card-panel");

          let cardPanelContent = document.createElement("div");
          cardPanelContent.classList.add("card-panel-content");
          cardPanelContent.dataset.id = id;

          let cardPanelTitle = document.createElement("div");
          cardPanelTitle.classList.add("card-panel-title");
          cardPanelTitle.innerHTML = name;

          let cardPanelLocation = document.createElement("div");
          cardPanelLocation.classList.add("card-panel-location");
          let locationHeading = document.createElement("p");
          locationHeading.textContent = location;
          cardPanelLocation.appendChild(locationHeading);

          let cardPanelImage = document.createElement("img");
          cardPanelImage.classList.add("card-panel-image");
          cardPanelImage.src = image;

          cardPanelContent.appendChild(cardPanelTitle);
          cardPanelContent.appendChild(cardPanelLocation);
          cardPanelContent.appendChild(cardPanelImage);

          cardPanel.appendChild(cardPanelContent); 
          cardPanelContainer.appendChild(cardPanel);
        }

        function AddAllItemsToCardPanel(restaurants,ids) {
          cardPanelContainer.innerHTML = "";
          var n = 0;
          restaurants.forEach(element => {
            let image = "/logo.png";
            AddItemToCardPanel(ids[n], element.name, element.location, image);
            n++;
          });
        }

        //-------------------------Get all Data----------------------------------------//
        const colRef = collection(db, "restaurants");
        async function GetAllDataOnce() {
          const querySnapshot = await getDocs(colRef);

          var restaurants = [];
          querySnapshot.forEach(doc => {
            restaurants.push(doc.data());
            rid = doc.id;
            ids.push(rid);

          });   
          AddAllItemsToCardPanel(restaurants,ids);
        }

        window.onload = GetAllDataOnce;

//-------------Event listener to each card panel-----------------------//
        cardPanelContainer.addEventListener('click', function(event) {

          // Retrieving unique identifier of chosen restaurant
          const restaurantId = event.target.closest('.card-panel-content').dataset.id;
          
          // Redirecting user to restaurant details page
          window.location.href = '/pages/restaurant.html?id=' + restaurantId;
        });

      </script>

<script src="/js/ui.js"></script>

</body>
</html>
 
